import{R as u,u as w,j as r}from"./index-D2bzoXqo.js";import{d,l as b,G as v,s as y,a as l,f as m,b as x,F as P,B as j,Q as C,c as E}from"./showErrorFlashMsg-13G2eMxS.js";const k=(o,s)=>o("/login",{state:{error_message:s}}),h=d("app:login:set-default-claims"),I=async(o,s,t)=>{try{await b.axiosWrapper("POST",t+"/auth/set-default-claims",{uid:s}),h("default claims set successfully. navigating to role selection."),o("/onboarding/role-selection")}catch(e){return h(`error occurred while setting default claims. ${e}`),k(o,"An error occurred. Please try again.")}},p=d("app:login:checkUserClaims"),f=async(o,s)=>{const t=o.user,a=(await t.getIdTokenResult()).claims,g=a.completed_onboarding===void 0,c=a.role===void 0,n=a.subscriptionId===void 0;return g||c||n?(console.warn("claims do not exist. setting default claims.",+JSON.stringify({onboardingStatus:g,role:c,subscriptionId:n})),await I(s,t.uid,"https://server-backend-4ag2pvjcbq-em.a.run.app/api/v1")):a.role===null?(p("user has claims set but has not chosen a role."),s("/onboarding/role-selection")):a.onboardingStatus?(p("navigating to dashboard."),s(`/${a.role}/dashboard`)):(p("user has claims & role set but has not completed onboarding."),s(`/onboarding/${a.role}`))},S=d("app:login:google-handler"),R=async o=>{const s=new v;s.setCustomParameters({login_hint:"user@example.com",prompt:"select_account"});const t=m.auth;t.useDeviceLanguage();const e=await y(t,s);return e?await f(e,o):(S("no response from google."),l("No response from google. Please login again. if issue persists, contact support."))},$=m.auth,i=d("app:login:email-handler"),L=async(o,s,t)=>{try{i("signing in with email and password.");const e=await x($,o,s);return await f(e,t)}catch(e){if(e instanceof P){if(e.code==="auth/user-not-found")return i("user not found."),l("No account found with this email.");if(e.code==="auth/invalid-email"||e.code==="auth/wrong-password"||e.code==="auth/invalid-credential")return i("invalid email."),l("Invalid email or password. Please try again.");if(e.code==="auth/user-disabled")return i("user disabled."),l("Account is disabled. Please contact support.");if(e.code==="auth/too-many-requests")return i("too many requests."),l("Too many requests. Please try again later.")}return i(`error occurred while signing in with email and password. ${e}`),l("An error occurred. Please try again.")}},A=()=>{const[o,s]=u.useState(""),[t,e]=u.useState(""),[a,g]=u.useState(void 0),c=w();return u.useEffect(()=>{a&&j.error(a,{theme:"colored"})},[]),r.jsxs("div",{children:[r.jsx(C,{position:"top-right",autoClose:5e3,hideProgressBar:!0,newestOnTop:!0,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"colored",limit:2,transition:E}),r.jsxs("form",{children:[r.jsx("label",{children:"Email"}),r.jsx("input",{type:"email",onChange:n=>{s(n.target.value)}}),r.jsx("label",{children:"Password"}),r.jsx("input",{type:"password",onChange:n=>e(n.target.value)}),r.jsx("button",{onClick:async n=>{n.preventDefault(),await L(o,t,c)},children:"Login"})]}),r.jsx("button",{onClick:async()=>await R(c),children:"Sign in with google"})]})};export{A as default};
